<html>
	<head>
		<title>Hubway Routes</title>
		<script type="text/javascript" src = "underscore-min.js"></script>
		<script type="text/javascript" src = "backbone-min.js"></script>
		<script type="text/javascript" src = "d3/d3.v2.js"></script>
		<style type="text/css">
			body {
				font-family:"helvetica neue","helvetica",sans-serif;
				font-size:0.8em;
			}
			
			.container svg {
			
				
			}
			
		</style>
	</head>
	<body>
		<h1>Hubway Bike Race!!!!!</h1>
		<script type="text/javascript">
			
			// based on mike bostock's https://gist.github.com/1584697
			
			/* set up the basics */
			/*
			var margin = {top: 0, right: 10, bottom: 20, left: 10},
				width = 960 - margin.left - margin.right,
				height = 500 - margin.top - margin.bottom;
			
			var index = d3.range(24),
				data = index.map(d3.random.normal(100, 10));
			
			var x = d3.scale.linear()
				.domain([0, d3.max(data)])
				.range([0, width]);
			
			var y = d3.scale.ordinal()
				.domain(index)
				.rangeRoundBands([0, height], .1);
			
			var svg = d3.select("body").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
			  .append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
			*/
			/*
			var bar = svg.selectAll(".bar")
				.data(data)
			  .enter().append("g")
				.attr("class", "bar")
				.attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });
			
			// this adds the actual bar area
			bar.append("rect")
				.attr("height", y.rangeBand())
				.attr("width", x);
			
			// this adds the text labels
			bar.append("text")
				.attr("text-anchor", "end")
				.attr("x", function(d) { return x(d) - 6; })
				.attr("y", y.rangeBand() / 2)
				.attr("dy", ".35em")
				.text(function(d, i) { return i; });
			
			// this is the axis
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0," + height + ")")
				.call(d3.svg.axis()
				.scale(x)
				.orient("bottom"));
			*/
			
			var sort = false;
			
			setInterval(function() {
			
				/*
			  if (sort = !sort) {
				index.sort(function(a, b) { return data[a] - data[b]; });
			  } else {
				index = d3.range(24);
			  }
			
			  y.domain(index);
			
			  bar.transition()
				  .duration(750)
				  .delay(function(d, i) { return i * 50; })
				  .attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });
				*/
			}, 5000);
			
			/*
			// set maximum bar constraints
			var maxbarw = 20,
				maxbarh = 80;
				
			var x = d3.scale.linear()
				.domain([0,1])
				.range([0,maxbarw]);
			
			var y = d3.scale.linear()
				.domain([0,100])
				.rangeRound([0,maxbarh]);
				
		
			var data = [4, 8, 15, 16, 23, 42];
		
			var svg = d3.select("body").append("svg")
				.attr("class","container")
				.attr("width", maxbarw * data.length - 1)
				.attr("height", maxbarh);
				
			svg.selectAll("rect")
				.data(data)
				.enter()
				.append("rect")
				.attr("x", function(d,i) {return x(i) - .5;})
				.attr("y", function(d) {return maxbarh - y(d.value) -.5;})
				.attr("width", maxbarw)
				.attr("height", function(d) {return y(d.value);})
			*/
			
			/*
			var data = [];
			
			var bikes;
			
			var w = 800;
			var h = 4000;
			
			// create the chart
			var svg = d3.select("body").append("svg")
				.attr("class","container")
				.attr("width",w)
				.attr("height",h);
			*/
			// Load the route data from CSV
			d3.csv('bikedaily.csv', function(rows) {
				
				//data = rows;
				
				// collect the data into groups by station
				
				bikes = _.groupBy(rows,function(row){return row.bike_nr;})
		
				data = d3.entries(bikes)
				
				var margin = {top: 0, right: 10, bottom: 20, left: 10},
					width = 960 - margin.left - margin.right,
					height = 10000 - margin.top - margin.bottom;
				/*
				var index = d3.range(24),
					data = index.map(d3.random.normal(100, 10));
				*/
				
				var x = d3.scale.linear()
					.domain([0, 1200])  // using data.length is probably not correct
					.range([0, width]);
				
				// get list of bikes to feed into the ordinal scale
				var bikenames = _.map(data,function(thing){return thing.key});
				//var ids = _.map(data,function(thing){return thing.key});
				
				var y = d3.scale.ordinal()
					.domain(d3.range(data.length))
					//.domain(d3.range(bikenames))
					//.domain(index)
					//.rangeRoundBands([0, height], .1);
					.rangeBands([0, height], .1);
				
				var svg = d3.select("body").append("svg")
					.attr("width", width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom)
				  .append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
		
		
				var bar = svg.selectAll(".bar")
					.data(d3.entries(bikes))
				  .enter().append("g")
					.attr("class", "bar")
					.attr("transform", function(d, i) { return "translate(0," + y(i) + ")"; });
					//.attr("transform", function(d, i) { return "translate(0," + y(0) + ")"; });
				
				// this adds the actual bar area
				bar.append("rect")
					.attr("height", y.rangeBand())
					//.attr("width", function(d) {return d.value[0]['distance'] * 10}); // need to take out this 10
					.attr("width", function(d,i) {return x(d.value[0]['distance'])}); // need to take out this 10
					//.attr("width", x);
				
				// this adds the text labels
				bar.append("text")
					.attr("text-anchor", "end")
					.attr("x", function(d) { return x(d) - 6; })
					.attr("y", y.rangeBand() / 2)
					.attr("dy", ".35em")
					.text(function(d, i) { return i; });
				
				// this is the axis
				svg.append("g")  // appends a new group element
					.attr("class", "x axis")
					.attr("transform", "translate(0," + height + ")")
					.call(d3.svg.axis()
					.scale(x)
					.orient("bottom"));
		
		
				// get the list of unique dates and order it into an array
				/*
				svg.selectAll("rect")
				.append("rect")
				.attr("x",0)
				.attr("y",0)
				.attr("width",500)
				.attr("height",100)
				
				svg.selectAll("rect")
					.data(bikes)
					.enter()
					.append("rect")
					.attr("x",function(d) {
						return 100;
					})
					.attr("y",function(d,i) {
						return -(i * (h / bikes.length));
					})
					.attr("fill", function(d) {
					
						return "blue";
					})
					*/
			})
		
			
			
		</script>
	</body>
</html>